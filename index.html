<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site de Criptomoedas</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-480406139"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-480406139');

        // Rastrear cliques em botões
        document.addEventListener("DOMContentLoaded", function() {
            document.querySelectorAll("button").forEach(button => {
                button.addEventListener("click", function() {
                    gtag("event", "click", {
                        "event_category": "Button",
                        "event_label": this.innerText
                    });
                });
            });
        });
    </script>
</head>
<body>

    <div id="prices-container"></div>
    <div id="news-container"></div>
    <div id="market-indicators"></div>

    <canvas id="priceChart"></canvas>

    <div>
        <input type="number" id="cryptoAmount" placeholder="Quantidade">
        <select id="cryptoSelect">
            <option value="bitcoin">Bitcoin (BTC)</option>
            <option value="ethereum">Ethereum (ETH)</option>
            <option value="solana">Solana (SOL)</option>
        </select>
        <button onclick="convertCrypto()">Converter</button>
        <p id="conversionResult"></p>
    </div>

    <script>
        const pricesContainer = document.getElementById('prices-container');
        const marketIndicators = document.getElementById('market-indicators');

        async function fetchCryptoPrices() {
            const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd');
            const data = await response.json();
            pricesContainer.innerHTML = `
                <div class="price-card"><h2>Bitcoin (BTC)</h2><p>$${data.bitcoin.usd}</p></div>
                <div class="price-card"><h2>Ethereum (ETH)</h2><p>$${data.ethereum.usd}</p></div>
                <div class="price-card"><h2>Solana (SOL)</h2><p>$${data.solana.usd}</p></div>`;
        }

        async function fetchPriceHistory() {
            const response = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=1');
            const data = await response.json();
            const prices = data.prices.map(price => ({ time: new Date(price[0]).toLocaleTimeString(), value: price[1] }));

            const ctx = document.getElementById('priceChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: prices.map(p => p.time),
                    datasets: [{ label: 'Preço do Bitcoin (USD)', data: prices.map(p => p.value), borderColor: '#50fa7b', borderWidth: 2 }]
                }
            });
        }

        async function convertCrypto() {
            const amount = document.getElementById('cryptoAmount').value;
            const crypto = document.getElementById('cryptoSelect').value;

            if (!amount || amount <= 0) return alert("Insira um valor válido.");

            const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${crypto}&vs_currencies=usd`);
            const data = await response.json();

            document.getElementById('conversionResult').innerText = `Valor em USD: $${(amount * data[crypto].usd).toFixed(2)}`;
        }

        async function fetchMarketData() {
            const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd&include_market_cap=true&include_24hr_high_low=true');
            const data = await response.json();

            marketIndicators.innerHTML = `
                ${Object.keys(data).map(coin => `
                    <div class="indicator"><h3>${coin.toUpperCase()}</h3><p>Market Cap: $${data[coin].usd_market_cap.toLocaleString()}</p></div>`).join('')}`;
        }

        fetchCryptoPrices();
        fetchPriceHistory();
        fetchMarketData();
    </script>

</body>
</html>
